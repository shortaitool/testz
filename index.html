<script>
    const firebaseConfig = {
        apiKey: "AIzaSyB0ZKcpIQEnBXHzPsfVNlwdL9Y-iJ4diZY",
        authDomain: "test-246af.firebaseapp.com",
        projectId: "test-246af",
        storageBucket: "test-246af.firebasestorage.app",
        messagingSenderId: "1025448533875",
        appId: "1:1025448533875:web:465de230000c809a1cef06"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const buttonGrid = document.getElementById('buttonGrid');
    const loginContainer = document.getElementById('loginContainer');
    const adminPanel = document.getElementById('adminPanel');
    const loginBtn = document.getElementById('loginBtn');
    const loginError = document.getElementById('loginError');
    const addButtonBtn = document.getElementById('addButton');
    const adminSuccess = document.getElementById('adminSuccess');
    const adminError = document.getElementById('adminError');

    // ✅ रियलटाइम Firestore लिस्नर
    function loadButtons() {
        db.collection('buttons').orderBy('timestamp','desc').onSnapshot(snapshot => {
            buttonGrid.innerHTML = ''; // पुराना डाटा हटाओ
            snapshot.forEach(doc => {
                const btn = doc.data();
                const div = document.createElement('div');
                div.classList.add('main-button');
                div.innerHTML = `
                    <img src="https://cdn-icons-png.flaticon.com/512/1023/1023656.png">
                    <h3>${btn.title}</h3>
                    <p>${btn.description}</p>
                `;
                buttonGrid.appendChild(div);
            });
        });
    }
    loadButtons();

    // ✅ यूज़र लॉगिन स्टेटस चेक
    auth.onAuthStateChanged(user => {
        if (user && user.email === "admin@example.com") {
            adminPanel.style.display = 'block';
            loginContainer.style.display = 'none';
        } else {
            adminPanel.style.display = 'none';
        }
    });

    // ✅ एडमिन लॉगिन
    loginBtn.addEventListener('click', () => {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        auth.signInWithEmailAndPassword(email, password)
            .then(() => {
                loginError.style.display = 'none';
                loginContainer.style.display = 'none';
                adminPanel.style.display = 'block';
            })
            .catch(() => loginError.style.display = 'block');
    });

    // ✅ नया बटन Firestore में सेव करना
    addButtonBtn.addEventListener('click', () => {
        const title = document.getElementById('buttonTitle').value;
        const description = document.getElementById('buttonDescription').value;
        if (title && description) {
            db.collection('buttons').add({
                title: title,
                description: description,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                adminSuccess.style.display = 'block';
                adminError.style.display = 'none';
                setTimeout(() => adminSuccess.style.display = 'none', 3000);
            }).catch(() => {
                adminError.style.display = 'block';
            });
        }
    });

    function openAdminLogin() {
        loginContainer.style.display = 'block';
    }

    function logoutAdmin() {
        auth.signOut();
        adminPanel.style.display = 'none';
    }
</script>
