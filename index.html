<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mock Tests Index + Admin — Rojgar With Ankit Style</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    :root{
      --bg: #f6f7fb;
      --card: #ffffff;
      --accent: #0b3b66;
      --muted: #7a8491;
      --accent-2: #e83e3e;
      --outline: rgba(11,59,102,0.12);
      --shadow: 0 6px 18px rgba(11,59,102,0.06);
      --radius: 14px;
    }
    *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#f6f7fb, #eef3f8);}
    .app{
      max-width:760px;margin:18px auto;padding:12px;
    }

    /* Header */
    header{
      display:flex;align-items:center;gap:12px;padding:12px;background:transparent;
    }
    .back-btn{
      display:inline-flex;align-items:center;justify-content:center;width:44px;height:44px;border-radius:12px;border:1px solid var(--outline);background:var(--card);box-shadow:var(--shadow);
      cursor:pointer;transition:transform .12s ease;
    }
    .back-btn:active{transform:scale(.97);}

    h1{font-size:20px;margin:0;color:var(--accent);font-weight:700;}
    .header-right{margin-left:auto;display:flex;gap:8px;align-items:center;}

    /* List */
    .list{margin-top:8px;display:flex;flex-direction:column;gap:12px;padding-bottom:90px;}
    .item{
      background:var(--card);display:flex;gap:12px;align-items:center;padding:10px;border-radius:12px;box-shadow:var(--shadow);border:1px solid rgba(0,0,0,0.02);
    }
    .item-thumb{
      width:72px;height:72px;border-radius:12px;flex:0 0 72px;background:#fff;display:flex;align-items:center;justify-content:center;overflow:hidden;border:1px solid var(--outline);
    }
    .item-thumb img{width:100%;height:100%;object-fit:cover;}
    .item-content{flex:1;}
    .title{font-weight:700;color:#0f2840;font-size:16px;line-height:1.15;}
    .meta{display:flex;gap:10px;align-items:center;margin-top:8px;color:var(--muted);font-size:13px}
    .share{display:inline-flex;align-items:center;gap:8px;cursor:pointer;color:var(--muted);}

    /* Admin Panel Button (outline & animated) */
    .btn{
      padding:10px 14px;border-radius:12px;border:2px solid var(--accent);background:transparent;color:var(--accent);font-weight:700;cursor:pointer;display:inline-flex;gap:8px;align-items:center;
      transition:transform .12s ease, box-shadow .12s ease, background .12s ease;
      box-shadow: 0 4px 12px rgba(11,59,102,0.06);
    }
    .btn:active{transform:scale(.98);}
    .btn-outline{
      background:transparent;
    }
    .btn-filled{
      background:var(--accent);color:#fff;border-color:transparent;
    }

    /* Floating admin quick button */
    .fab{
      position:fixed;right:18px;bottom:18px;z-index:1000;
      display:inline-flex;align-items:center;justify-content:center;width:56px;height:56px;border-radius:16px;background:linear-gradient(135deg,#0b3b66,#0a78b5);color:#fff;box-shadow:0 12px 30px rgba(10,55,110,0.18);border:none;
      cursor:pointer;transition:transform .12s ease;
    }
    .fab:active{transform:scale(.96);}

    /* Admin modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(8,15,25,0.45);display:none;align-items:center;justify-content:center;padding:18px;z-index:1200;}
    .modal{width:100%;max-width:720px;background:var(--card);border-radius:16px;padding:18px;box-shadow:0 24px 60px rgba(2,6,23,0.4);border:1px solid rgba(0,0,0,0.04);max-height:90vh;overflow:auto;}
    .modal .close{margin-left:auto;background:transparent;border:none;font-size:18px;cursor:pointer;color:var(--muted);}

    form.row{display:flex;gap:8px;flex-wrap:wrap;}
    label{font-size:13px;color:var(--muted);margin-bottom:6px;display:block;}
    input[type="text"], input[type="email"], input[type="password"], textarea{
      width:100%;padding:10px;border-radius:10px;border:1px solid var(--outline);background:#fbfdff;font-size:14px;
    }
    .field{flex:1 1 100%;}
    .field.half{flex:1 1 calc(50% - 8px);}

    /* admin list inside modal */
    .admin-list{margin-top:12px;display:flex;flex-direction:column;gap:10px;}
    .admin-row{display:flex;gap:10px;align-items:center;padding:10px;border-radius:12px;background:linear-gradient(180deg,#fff,#fbfdff);border:1px solid var(--outline);}
    .admin-row .small-thumb{width:56px;height:56px;border-radius:8px;overflow:hidden;}
    .admin-row .small-thumb img{width:100%;height:100%;object-fit:cover;}
    .admin-row .admin-actions{margin-left:auto;display:flex;gap:8px;}

    /* responsive */
    @media (max-width:480px){
      .item-thumb{width:64px;height:64px}
      .btn{padding:8px 12px;font-size:14px}
    }

    /* small animations for buttons */
    .pulse{
      position:relative;
      overflow:hidden;
    }
    .pulse:after{
      content:"";position:absolute;left:50%;top:50%;transform:translate(-50%,-50%) scale(0);width:120%;height:120%;background:rgba(11,59,102,0.06);border-radius:inherit;transition:transform .42s cubic-bezier(.2,.9,.3,1);
    }
    .pulse:active:after{transform:translate(-50%,-50%) scale(1);}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <button class="back-btn" onclick="history.back()"><i class="fa fa-arrow-left"></i></button>
      <h1>Mock Tests Index</h1>

      <div class="header-right">
        <button id="adminOpenBtn" class="btn btn-outline pulse"><i class="fa fa-user-shield"></i> Admin</button>
      </div>
    </header>

    <section id="listSection" class="list" aria-live="polite">
      <!-- items will render here -->
    </section>

    <!-- Floating admin -->
    <button class="fab" id="fabAdmin" title="Admin (login)"><i class="fa fa-gear"></i></button>
  </div>

  <!-- Admin Modal -->
  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true">
    <div class="modal" role="document">
      <div style="display:flex;gap:12px;align-items:center;">
        <h2 style="margin:0;color:var(--accent)">Admin Panel</h2>
        <button class="close" onclick="closeModal()"><i class="fa fa-times"></i></button>
      </div>

      <div id="authSection" style="margin-top:12px;">
        <!-- Login form -->
        <div id="loginForm">
          <p style="color:var(--muted)">Admin login required. (Use Firebase Email/Password auth)</p>
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <div class="field half">
              <label>Email</label>
              <input id="loginEmail" type="email" placeholder="admin@example.com">
            </div>
            <div class="field half">
              <label>Password</label>
              <input id="loginPass" type="password" placeholder="Password">
            </div>
            <div style="width:100%;display:flex;gap:8px;margin-top:8px;">
              <button class="btn pulse" id="loginBtn"><i class="fa fa-sign-in-alt"></i> Login</button>
              <button class="btn btn-outline pulse" id="signupBtn" title="Create admin (only initially)"> <i class="fa fa-user-plus"></i> Create</button>
              <button class="btn btn-outline pulse" onclick="closeModal()">Close</button>
            </div>
          </div>
        </div>

        <!-- Logged in admin area -->
        <div id="adminArea" style="display:none;margin-top:12px;">
          <div style="display:flex;gap:8px;align-items:center;">
            <div style="font-weight:700;color:var(--accent)">Logged in as <span id="adminEmailDisplay"></span></div>
            <button class="btn btn-outline" id="logoutBtn">Logout</button>
          </div>

          <!-- Add / Edit form -->
          <div style="margin-top:12px;">
            <h3 style="margin:0 0 8px 0;">Add / Edit Test</h3>
            <form id="itemForm" class="row" onsubmit="return false;">
              <input type="hidden" id="editingId" value="">
              <div class="field">
                <label>Title</label>
                <input id="itemTitle" type="text" placeholder="UP Police SI 2025">
              </div>
              <div class="field">
                <label>Image URL</label>
                <input id="itemImage" type="text" placeholder="https://.../image.jpg">
              </div>
              <div style="width:100%;display:flex;gap:8px;margin-top:6px;">
                <button id="saveItemBtn" class="btn pulse"><i class="fa fa-save"></i> Save</button>
                <button id="clearFormBtn" class="btn btn-outline pulse">Clear</button>
              </div>
            </form>
          </div>

          <!-- Admin items list -->
          <div class="admin-list" id="adminList" style="margin-top:12px;">
            <!-- admin rows injected -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs (compat mode for simpler single-file) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    /******************************************
     * IMPORTANT: Replace the firebaseConfig below
     * with your project's config from Firebase Console
     ******************************************/
    const firebaseConfig = {
       apiKey: "AIzaSyB0ZKcpIQEnBXHzPsfVNlwdL9Y-iJ4diZY",
  authDomain: "test-246af.firebaseapp.com",
  projectId: "test-246af",
  storageBucket: "test-246af.firebasestorage.app",
  messagingSenderId: "1025448533875",
  appId: "1:1025448533875:web:465de230000c809a1cef06",
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // UI elements
    const listSection = document.getElementById('listSection');
    const modalBackdrop = document.getElementById('modalBackdrop');
    const adminOpenBtn = document.getElementById('adminOpenBtn');
    const fabAdmin = document.getElementById('fabAdmin');

    const loginBtn = document.getElementById('loginBtn');
    const signupBtn = document.getElementById('signupBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const loginEmail = document.getElementById('loginEmail');
    const loginPass = document.getElementById('loginPass');
    const adminArea = document.getElementById('adminArea');
    const loginFormEl = document.getElementById('loginForm');
    const adminEmailDisplay = document.getElementById('adminEmailDisplay');

    const itemForm = document.getElementById('itemForm');
    const itemTitle = document.getElementById('itemTitle');
    const itemImage = document.getElementById('itemImage');
    const saveItemBtn = document.getElementById('saveItemBtn');
    const clearFormBtn = document.getElementById('clearFormBtn');
    const editingId = document.getElementById('editingId');
    const adminList = document.getElementById('adminList');

    // open modal
    function openModal(){
      modalBackdrop.style.display = 'flex';
    }
    function closeModal(){
      modalBackdrop.style.display = 'none';
    }
    adminOpenBtn.addEventListener('click', openModal);
    fabAdmin.addEventListener('click', openModal);
    modalBackdrop.addEventListener('click', (e)=>{ if(e.target === modalBackdrop) closeModal(); });

    // Auth actions
    loginBtn.addEventListener('click', async ()=>{
      const email = loginEmail.value.trim();
      const pass = loginPass.value;
      if(!email || !pass){ alert('Email aur Password bharen'); return; }
      try{
        await auth.signInWithEmailAndPassword(email, pass);
      }catch(err){
        alert('Login error: ' + err.message);
      }
    });
    signupBtn.addEventListener('click', async ()=>{
      const email = loginEmail.value.trim();
      const pass = loginPass.value;
      if(!email || !pass){ alert('Email aur Password bharen'); return; }
      if(!confirm('Kya aap naya admin account banana chahte hain? (sirf initial setup ke liye)')) return;
      try{
        await auth.createUserWithEmailAndPassword(email, pass);
        alert('Admin account created. Now login.');
      }catch(err){
        alert('Signup error: ' + err.message);
      }
    });
    logoutBtn.addEventListener('click', ()=>auth.signOut());

    // Auth state observer
    auth.onAuthStateChanged(user=>{
      if(user){
        // show admin UI
        loginFormEl.style.display = 'none';
        adminArea.style.display = 'block';
        adminEmailDisplay.textContent = user.email;
        loadAdminList();
      }else{
        loginFormEl.style.display = 'block';
        adminArea.style.display = 'none';
      }
    });

    // Load items (public view)
    async function loadItems(){
      listSection.innerHTML = '<div style="text-align:center;color:var(--muted);padding:18px;">Loading...</div>';
      try{
        const snapshot = await db.collection('tests').orderBy('createdAt','desc').get();
        renderList(snapshot.docs.map(d=>({id:d.id, ...d.data()})));
      }catch(err){
        listSection.innerHTML = '<div style="text-align:center;color:var(--muted);padding:18px;">Error loading data. Check Firebase config + rules.</div>';
        console.error(err);
      }
    }

    function renderList(items){
      if(items.length === 0){
        listSection.innerHTML = '<div style="text-align:center;color:var(--muted);padding:18px;">Koi test nahi mila.</div>';
        return;
      }
      listSection.innerHTML = '';
      items.forEach(it=>{
        const div = document.createElement('div'); div.className = 'item';
        const thumb = document.createElement('div'); thumb.className='item-thumb';
        const img = document.createElement('img');
        img.src = it.image || 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="300"><rect width="100%" height="100%" fill="%23f2f5f8"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="%2399a6b2" font-size="24">No Image</text></svg>';
        thumb.appendChild(img);

        const content = document.createElement('div'); content.className='item-content';
        const title = document.createElement('div'); title.className='title'; title.textContent = it.title || 'Untitled';
        const meta = document.createElement('div'); meta.className='meta';
        const share = document.createElement('div'); share.className='share'; share.innerHTML = '<i class="fa fa-share"></i> Share';
        share.onclick = ()=> shareItem(it);
        meta.appendChild(share);
        content.appendChild(title);
        content.appendChild(meta);

        div.appendChild(thumb); div.appendChild(content);
        listSection.appendChild(div);
      });
    }

    function shareItem(item){
      const url = location.href; // you can refine to link to specific page
      const text = item.title + ' — Check this mock test';
      if(navigator.share){
        navigator.share({title:item.title,text, url}).catch(()=>{});
      }else{
        // fallback: copy link
        navigator.clipboard?.writeText(url).then(()=> alert('Link copied to clipboard'));
      }
    }

    // Admin: add/edit/delete
    saveItemBtn.addEventListener('click', async ()=>{
      const title = itemTitle.value.trim();
      const image = itemImage.value.trim();
      if(!title){ alert('Title bharen'); return; }
      const id = editingId.value || null;
      try{
        if(id){
          await db.collection('tests').doc(id).update({title, image, updatedAt: firebase.firestore.FieldValue.serverTimestamp()});
          alert('Updated');
        }else{
          await db.collection('tests').add({title, image, createdAt: firebase.firestore.FieldValue.serverTimestamp()});
          alert('Added');
        }
        itemFormReset();
        loadAdminList(); loadItems();
      }catch(err){
        alert('Error saving: ' + err.message);
      }
    });

    clearFormBtn.addEventListener('click', (e)=>{ e.preventDefault(); itemFormReset(); });

    function itemFormReset(){
      editingId.value = '';
      itemTitle.value = '';
      itemImage.value = '';
      saveItemBtn.textContent = ' Save';
      saveItemBtn.insertAdjacentHTML('afterbegin','<i class="fa fa-save"></i>');
    }

    async function loadAdminList(){
      adminList.innerHTML = '<div style="color:var(--muted)">Loading admin items...</div>';
      try{
        const snapshot = await db.collection('tests').orderBy('createdAt','desc').get();
        adminList.innerHTML = '';
        snapshot.docs.forEach(doc=>{
          const data = {id:doc.id, ...doc.data()};
          const row = document.createElement('div'); row.className = 'admin-row';
          const thumb = document.createElement('div'); thumb.className='small-thumb';
          const img = document.createElement('img'); img.src = data.image || 'https://via.placeholder.com/160x90?text=No+Image';
          thumb.appendChild(img);
          const info = document.createElement('div'); info.style.flex='1';
          info.innerHTML = `<div style="font-weight:700;color:#0e2a45">${escapeHtml(data.title||'Untitled')}</div><div style="font-size:12px;color:var(--muted);margin-top:6px;">ID: ${doc.id}</div>`;
          const actions = document.createElement('div'); actions.className='admin-actions';
          const editBtn = document.createElement('button'); editBtn.className='btn btn-outline pulse'; editBtn.innerHTML='<i class="fa fa-edit"></i>';
          editBtn.onclick = ()=> populateForEdit(doc.id, data);
          const delBtn = document.createElement('button'); delBtn.className='btn pulse'; delBtn.innerHTML='<i class="fa fa-trash"></i>';
          delBtn.onclick = ()=> removeItem(doc.id);
          actions.appendChild(editBtn); actions.appendChild(delBtn);

          row.appendChild(thumb); row.appendChild(info); row.appendChild(actions);
          adminList.appendChild(row);
        });
      }catch(err){
        adminList.innerHTML = '<div style="color:var(--muted)">Error loading admin items</div>';
        console.error(err);
      }
    }

    function populateForEdit(id, data){
      editingId.value = id;
      itemTitle.value = data.title || '';
      itemImage.value = data.image || '';
      saveItemBtn.innerHTML = '<i class="fa fa-save"></i> Update';
      // ensure admin modal visible
      openModal();
    }

    async function removeItem(id){
      if(!confirm('Kya aap sach me is item ko delete karna chahte hain?')) return;
      try{
        await db.collection('tests').doc(id).delete();
        alert('Deleted');
        loadAdminList(); loadItems();
      }catch(err){
        alert('Delete error: ' + err.message);
      }
    }

    // Utility: escapeHtml for safety in admin list rendering
    function escapeHtml(s){
      if(!s) return '';
      return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;');
    }

    // Initialize: load items and set up live updates
    async function init(){
      // Listen to realtime changes to keep UI in sync
      db.collection('tests').orderBy('createdAt','desc').onSnapshot(snapshot=>{
        const items = snapshot.docs.map(d=>({id:d.id, ...d.data()}));
        renderList(items);
      }, err=>{
        console.error('realtime error', err);
        // fallback to load once
        loadItems();
      });
    }

    init();

    // If you want to deep-link admin page: ?admin=true
    if(new URLSearchParams(location.search).get('admin') === 'true') openModal();

    // Helpful dev hint in console:
    console.log('%cAdmin panel: open modal with Admin button. Use Firebase Email/Password auth.', 'color:#0b3b66;font-weight:700');

  </script>

  <!--
    Setup instructions (short):
    1) Create Firebase project -> enable Authentication (Email/Password).
    2) Create Firestore database (start in test mode for development).
    3) Paste your Firebase config in firebaseConfig at top of script.
    4) Optionally set Firestore rules to allow read for all, write only for authenticated:
       Example rules (Firestore):
       service cloud.firestore {
         match /databases/{database}/documents {
           match /tests/{docId} {
             allow read: if true;
             allow write: if request.auth != null;
           }
         }
       }
    5) Deploy to Firebase Hosting or upload to any web host.
    6) Create an admin user once by using the "Create" button in the login form (or create via Firebase Console).
  -->
</body>
</html>
