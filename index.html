<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>рдСрд▓ рдЬреЙрдм рдЯреЗрд╕реНрдЯ</title>
    <script type="module">
        // тЬЕ Firebase Import
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";

        // тЬЕ Firebase Config (рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рджреА рдЧрдИ)
        const firebaseConfig = {
            apiKey: "AIzaSyB0ZKcpIQEnBXHzPsfVNlwdL9Y-iJ4diZY",
            authDomain: "test-246af.firebaseapp.com",
            projectId: "test-246af",
            storageBucket: "test-246af.firebasestorage.app",
            messagingSenderId: "1025448533875",
            appId: "1:1025448533875:web:465de230000c809a1cef06",
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let data = { mainTitle: 'рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ...', cards: [] };

        async function loadData() {
            const docRef = doc(db, "siteData", "main");
            onSnapshot(docRef, (snapshot) => {
                if (snapshot.exists()) {
                    data = snapshot.data();
                    renderCards();
                    document.getElementById('mainTitle').innerText = data.mainTitle;
                } else {
                    console.log("тЪа рдбреЗрдЯрд╛ Firestore рдореЗрдВ рдирд╣реАрдВ рдорд┐рд▓рд╛, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдбреЗрдЯрд╛ рдпреВрдЬрд╝ рд╣реЛрдЧрд╛");
                }
            });
        }

        async function saveToFirestore() {
            await setDoc(doc(db, "siteData", "main"), data);
            alert("тЬЕ Firebase рдкрд░ рд╕реЗрд╡ рд╣реЛ рдЧрдпрд╛!");
        }

        function renderCards() {
            const grid = document.getElementById('cardsGrid');
            grid.innerHTML = '';
            data.cards.forEach(card => {
                const div = document.createElement('div');
                div.className = 'card';
                div.onclick = () => openSlide(2, card.name, card.id);
                div.innerHTML = `
                    <img src="${card.img}" alt="Image ${card.id}">
                    <div class="card-text">${card.name}</div>
                `;
                grid.appendChild(div);
            });
        }

        // тЬЕ Auth Functions
        async function loginAdmin() {
            const email = document.getElementById("adminEmail").value;
            const password = document.getElementById("adminPass").value;
            try {
                await signInWithEmailAndPassword(auth, email, password);
                alert("тЬЕ рд▓реЙрдЧрд┐рди рд╕рдлрд▓!");
                openAdminPanel();
            } catch (error) {
                alert("тЪа рд▓реЙрдЧрд┐рди рдлреЗрд▓реНрдб: " + error.message);
            }
        }

        function openAdminPanel() {
            document.querySelectorAll('.slide').forEach(slide => slide.classList.add('hidden'));
            document.getElementById('adminPanel').classList.remove('hidden');
            renderAdminEditors();
        }

        function saveChanges() {
            // Main Title
            data.mainTitle = document.getElementById('editMainTitle').value;

            // Cards Update
            data.cards.forEach(card => {
                card.name = document.getElementById(`editCardName${card.id}`).value;
                card.img = document.getElementById(`editCardImg${card.id}`).value;

                card.parts.forEach(part => {
                    part.name = document.getElementById(`editPartName${card.id}_${part.id}`).value;
                    part.tests.forEach(test => {
                        test.name = document.getElementById(`editTestName${card.id}_${part.id}_${test.id}`).value;
                        test.href = document.getElementById(`editTestHref${card.id}_${part.id}_${test.id}`).value;
                    });
                });
            });

            saveToFirestore();
            renderCards();
            openSlide(1);
        }

        window.onload = () => {
            loadData();
        };
    </script>
    <style>
        /* рдЖрдкрдХреА рдкреБрд░рд╛рдиреА CSS рд╡рд╣реА рд░рдЦреА рдЧрдИ рд╣реИ */
    </style>
</head>
<body>
    <div class="container">
        <!-- Slide 1 -->
        <div id="slide1" class="slide">
            <h2 id="mainTitle">рдСрд▓ рдЬреЙрдм рдЯреЗрд╕реНрдЯ</h2>
            <div id="cardsGrid" class="grid"></div>
            <br>
            <button class="btn" onclick="document.getElementById('adminLogin').classList.remove('hidden');">ЁЯФС рдПрдбрдорд┐рди рдкреИрдирд▓</button>
        </div>

        <!-- Admin Login -->
        <div id="adminLogin" class="slide hidden">
            <button class="back-btn" onclick="openSlide(1)">тмЕ рд╡рд╛рдкрд╕ рдЬрд╛рдПрдВ</button>
            <h2>Admin Login</h2>
            <input type="email" id="adminEmail" placeholder="рдИрдореЗрд▓ рдбрд╛рд▓реЗрдВ">
            <input type="password" id="adminPass" placeholder="рдкрд╛рд╕рд╡рд░реНрдб рдбрд╛рд▓реЗрдВ">
            <button class="save-btn" onclick="loginAdmin()">Login</button>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" class="slide hidden">
            <button class="back-btn" onclick="openSlide(1)">тмЕ рдмрд╛рд╣рд░ рдирд┐рдХрд▓реЗрдВ</button>
            <h2>Admin Panel</h2>
            <input type="text" id="editMainTitle" placeholder="Main Title">
            <div id="cardsEditor"></div>
            <button class="add-btn" onclick="addNewCard()">рдирдпрд╛ рдХрд╛рд░реНрдб рдЬреЛрдбрд╝реЗрдВ</button>
            <button class="save-btn" onclick="saveChanges()">Save Changes</button>
        </div>
    </div>
</body>
</html>
